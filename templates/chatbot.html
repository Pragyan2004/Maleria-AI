{% extends "base.html" %}

{% block title %}AI Chatbot - Malaria Assistant{% endblock %}

{% block extra_css %}
<style>
    .chat-container {
        height: 550px;
        overflow-y: auto;
        background: #f8fafc;
        border-radius: 20px;
        padding: 25px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        scroll-behavior: smooth;
    }

    .message {
        margin-bottom: 20px;
        max-width: 85%;
        padding: 14px 20px;
        border-radius: 20px;
        position: relative;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        animation: fadeInUp 0.5s ease-out forwards;
    }

    .user-message {
        margin-left: auto;
        background: linear-gradient(135deg, var(--primary), #6366f1);
        color: white;
        border-bottom-right-radius: 4px;
    }

    .bot-message {
        margin-right: auto;
        background: white;
        color: var(--text-main);
        border-bottom-left-radius: 4px;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .message-time {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 6px;
        display: block;
    }

    .suggestion-chip {
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: white;
        color: var(--primary);
        border: 1px solid var(--primary);
        padding: 8px 16px !important;
        border-radius: 50px !important;
    }

    .suggestion-chip:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
    }

    .typing .dot {
        height: 8px;
        width: 8px;
        background: var(--primary);
        border-radius: 50%;
        display: inline-block;
        animation: bounce 1.4s infinite ease-in-out both;
    }

    .typing .dot1 {
        animation-delay: -0.32s;
    }

    .typing .dot2 {
        animation-delay: -0.16s;
    }

    @keyframes bounce {

        0%,
        80%,
        100% {
            transform: scale(0);
        }

        40% {
            transform: scale(1.0);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card shadow">
            <div class="card-header border-0 bg-transparent pt-4 px-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="fw-800 mb-1 text-gradient">AI Medical Assistant</h3>
                        <p class="text-muted small mb-0"><i class="fas fa-circle text-success me-1 tiny"></i> Neural
                            Network V3 Active</p>
                    </div>
                    <button id="clearChatBtn" class="btn btn-soft-danger btn-sm rounded-pill px-3">
                        <i class="fas fa-trash-alt me-1"></i> Reset
                    </button>
                </div>
            </div>
            <div class="card-body p-4">
                <!-- Advanced Recommendations -->
                <div class="mb-4">
                    <h6 class="text-uppercase ls-1 fw-bold text-muted small mb-3">Diagnostic Recommendations:</h6>
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-outline-primary btn-sm rounded-pill suggestion-chip"
                            onclick="askQuestion(this)">
                            What are the early warning signs?
                        </button>
                        <button class="btn btn-outline-primary btn-sm rounded-pill suggestion-chip"
                            onclick="askQuestion(this)">
                            How is malaria diagnosed accurately?
                        </button>
                        <button class="btn btn-outline-primary btn-sm rounded-pill suggestion-chip"
                            onclick="askQuestion(this)">
                            Best prevention for travelers?
                        </button>
                        <button class="btn btn-outline-primary btn-sm rounded-pill suggestion-chip"
                            onclick="askQuestion(this)">
                            Compare malaria parasites types
                        </button>
                        <button class="btn btn-outline-primary btn-sm rounded-pill suggestion-chip"
                            onclick="askQuestion(this)">
                            Latest WHO treatment guidelines 2026
                        </button>
                    </div>
                </div>

                <!-- Chat Container -->
                <div class="chat-container mb-3" id="chatContainer">
                    <!-- Messages will be inserted here -->
                    <div class="message bot-message">
                        <strong>Malaria AI Assistant:</strong>
                        <p>Hello! ðŸ‘‹ I'm your AI assistant for malaria information.</p>
                        <p>I can help you with:</p>
                        <ul class="mb-2">
                            <li>Malaria symptoms and signs</li>
                            <li>Prevention methods and tips</li>
                            <li>Treatment information</li>
                            <li>Risk factors and areas</li>
                            <li>General malaria knowledge</li>
                        </ul>
                        <p><strong>Important:</strong> I provide information only. For medical advice, please consult a
                            healthcare professional.</p>
                        <p>How can I assist you today?</p>
                        <div class="message-time">Just now</div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="input-group">
                    <input type="text" id="messageInput" class="form-control"
                        placeholder="Ask about malaria symptoms, prevention, treatment..."
                        onkeypress="handleKeyPress(event)">
                    <button class="btn btn-primary" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i> Send
                    </button>
                </div>

                <!-- Features -->
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-shield-alt fa-2x text-primary mb-3"></i>
                                <h5>Prevention Tips</h5>
                                <p class="small">Get personalized malaria prevention recommendations</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-heartbeat fa-2x text-danger mb-3"></i>
                                <h5>Symptom Checker</h5>
                                <p class="small">Understand common malaria symptoms and warning signs</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-globe-americas fa-2x text-success mb-3"></i>
                                <h5>Risk Assessment</h5>
                                <p class="small">Learn about malaria risk in different regions</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        initChatbot();
    });
</script>
{% endblock %}